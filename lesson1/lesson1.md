# Event Loop

简单来说，**事件循环 (Event Loop)** 是 JavaScript 处理非阻塞、异步操作的核心心脏。

因为 JavaScript 是**单线程**的（一次只能做一件事），为了不让耗时的任务（如网络请求）卡死网页，它需要一套机制来协调任务的执行顺序。

## 宏任务 vs 微任务

| **类型**               | **任务内容 (举例)**                                            | **优先级**        |
| ---------------------- | -------------------------------------------------------------- | ----------------- |
| **微任务 (Microtask)** | `Promise.then `                                                | **高** (插队执行) |
| **宏任务 (Macrotask)** | `setTimeout`、`setInterval`、`I/O`、UI 渲染、`script` 整体代码 | **低** (排队执行) |

## 总结

- **宏任务**是按部就班的排队。
- **微任务**是 VIP 快速通道，只要当前活干完了，立马优先处理所有 VIP。
- **Event Loop** 就是不断地在“执行宏任务（最开始是整段 `<script>` 代码） -> 清空微任务 -> 渲染 -> 执行下一个宏任务（从宏任务队列中取出一个执行）”之间循环。

## 小知识点

| **关键词**      | **类别** | **作用**                                     |
| --------------- | -------- | -------------------------------------------- |
| **window**      | 环境对象 | 浏览器里的“老大”                             |
| **global**      | 环境对象 | Node.js 里的“老大”                           |
| **globalThis**  | 环境对象 | 跨平台通用的“老大”访问方式                   |
| **Macro-tasks** | 任务调度 | 宏任务、异步执行的、较大的代码块（如定时器） |

globalThis (现代 JS 的标准)

- 前写代码如果想兼容浏览器和 Node.js，得写一堆判断：`var root = (typeof window !== 'undefined' ? window : global)`。这太麻烦了。

- ES2020 引入的一个标准属性，它**在任何环境下都指向该环境的全局对象**。
  - 在浏览器中，它指向 `window`。

  - 在 Node.js 中，它指向 `global`。
